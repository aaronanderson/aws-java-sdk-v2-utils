# jax-rs-aws-signerv4
After scouring the Internet for a simple [AWS Signature Version 4 Signing](https://docs.aws.amazon.com/general/latest/gr/signature-version-4.html) java library with limited dependencies and support for JAX-RS 2.0 and not finding one I decided to write one. 

The main motivation for this library is to support JAX-RS calls to an AWS elasticsearch instance. the AWS Java API 2.0 has a client class for managing search domains but nothing for actually accessing the service.

Previously I had used the AWS SDK 2.0 preview to create a [S3 presigning URL](https://gist.github.com/aaronanderson/f9e2806cc5e2c18fab4d7e60c589d160) Java utility but the current SDK codebase is geared for autogenerated clients and it is challenging to write a client by hand that initializes all the prerequisites. After examining several other Java AWS signing implementations and studying the AWS signing documentation I was able to develop a solution that meets my requirements. As an added bonus I was able to add presigning capabilities for S3 with little effort. 

If including an entire JAX-RS implementation is not an option, perhaps due to an AWS Lambda library size constraint, there is an example of using the AWS 2.0 SDK to send a signed request to an endpoint. This example uses the bare minimum client configuration to avoid NPEs. 

## Configuration
Create an instance of the AWSSignerClientRequestFilter class using the builder. Provide the AWS 
```
DefaultCredentialsProvider provider  = DefaultCredentialsProvider.create();
credentials = provider.getCredentials();
AWSSignerClientRequestFilter.Builder builder = AWSSignerClientRequestFilter.builder().accessKeyID(credentials.accessKeyId()).secretAccessKey(credentials.secretAccessKey()).regionName("us-west-1").serviceName("es");
if (AwsSessionCredentials.class.isAssignableFrom(credentials.getClass())) {
  builder.sessionToken(() -> (((AwsSessionCredentials) credentials).sessionToken()));
}
AWSSignerClientRequestFilter signer = builder.build();
```
Note I have not actually testes the token session feature but it should work.

##JAX-RS
Just register the filter/interceptor
```
client.register(signer);
```

##Pre-Sign
Pass in the method, requestURI, and expiration duration
```
URI presigned = signer.presign("GET", new URI("https://some-s3-bucket.s3-us-west-1.amazonaws.com/intworkspace.json"), Duration.ofDays(1));
```

##AWS Java SDK 2.0 HTTP Client
Configure the signing information and create a SdkHttpFullRequest request. Tested with version 2.0.0-preview-7
```
DefaultCredentialsProvider provider = DefaultCredentialsProvider.create();
		AwsCredentials awsCredentials = provider.getCredentials();
		SdkHttpClient sdkClient = ApacheSdkHttpClientFactory.builder().build().createHttpClient();
		AWSSignerHttpClient client = AWSSignerHttpClient.builder().awsCredentials(awsCredentials).region(Region.US_WEST_1).serviceName("es").sdkClient(sdkClient).build();

		SdkHttpFullRequest httpRequest = SdkHttpFullRequest.builder().method(SdkHttpMethod.GET).protocol("https").host("search-some-aws-elasticsearch-domain.us-west-1.es.amazonaws.com").build();
		JsonObject obj = client.<JsonObject> execute(httpRequest);
```
